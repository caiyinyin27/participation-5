<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>China Streaming Market Popularity – Grid Cartogram</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg: #0b0b1b;
            --card-bg: rgba(15, 15, 35, 0.7);
            --primary: #00ffff;
            --high: #9c27b0;
            --medium: #3f51b5;
            --low: #1a237e;
            --glow: 0 0 20px rgba(0, 255, 255, 0.5);
            --text: #e0f7fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            padding: 40px 20px;
            line-height: 1.7;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
        }

        h1 {
            font-size: 2.4rem;
            color: var(--primary);
            text-shadow: 0 0 15px var(--primary);
            margin-bottom: 12px;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 1.1rem;
            font-style: italic;
            opacity: 0.9;
            max-width: 900px;
            margin: 0 auto;
        }

        .container {
            max-width: 1350px;
            margin: 0 auto;
        }

        .cartogram-card {
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--glow);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .pixel-grid-overlay {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(0,255,255,0.07) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,255,255,0.07) 1px, transparent 1px);
            background-size: 32px 32px;
            pointer-events: none;
            border-radius: 16px;
        }

        #cartogram {
            display: block;
            width: 100%;
            max-width: 1250px;
            margin: 0 auto;
        }

        .province-rect {
            stroke: #222;
            stroke-width: 1.5;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            filter: drop-shadow(0 0 3px currentColor);
        }

        .province-rect:hover {
            stroke: #ffff00;
            stroke-width: 3;
            filter: brightness(1.5) drop-shadow(0 0 12px #ffff00);
            transform: scale(1.12);
            z-index: 10;
        }

        .tier-high { fill: var(--high); }
        .tier-medium { fill: var(--medium); }
        .tier-low { fill: var(--low); }

        .label {
            font-size: 11px;
            fill: var(--primary);
            text-anchor: middle;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 0 0 8px #000;
            dominant-baseline: middle;
        }

        .tooltip {
            position: absolute;
            background: rgba(10, 10, 25, 0.97);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 14px 18px;
            font-size: 14px;
            font-weight: bold;
            color: var(--primary);
            box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.25s ease;
            z-index: 1000;
            min-width: 180px;
            text-align: center;
            line-height: 1.5;
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-top-color: var(--primary);
        }

        /* === LEGEND TABLE WITH COLORED CELLS === */
        .legend-table {
            margin: 45px auto 25px;
            border-collapse: collapse;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--glow);
            width: fit-content;
            font-size: 15px;
        }

        .legend-table th {
            background: linear-gradient(135deg, rgba(0,255,255,0.2), rgba(0,255,255,0.1));
            color: var(--primary);
            padding: 16px 28px;
            text-shadow: 0 0 8px var(--primary);
            font-weight: bold;
            font-size: 1.1rem;
        }

        .legend-table td {
            padding: 14px 22px;
            border-top: 1px solid rgba(0, 255, 255, 0.25);
            color: #b2ebf2;
        }

        .legend-cell {
            width: 28px;
            height: 28px;
            display: inline-block;
            margin-right: 14px;
            border-radius: 6px;
            border: 2px solid #fff;
            vertical-align: middle;
            box-shadow: 0 0 12px currentColor;
            transition: transform 0.2s ease;
        }

        .legend-cell:hover {
            transform: scale(1.15);
        }

        .legend-cell.high { background-color: var(--high); }
        .legend-cell.medium { background-color: var(--medium); }
        .legend-cell.low { background-color: var(--low); }

        .legend-tier {
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 6px currentColor;
        }

        .legend-tier.high { color: #e1bee7; }
        .legend-tier.medium { color: #7986cb; }
        .legend-tier.low { color: #9fa8da; }

        .footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.95rem;
            opacity: 0.75;
            font-style: italic;
        }

        @keyframes data-pulse {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }

        .province-rect {
            animation: data-pulse 3s infinite ease-in-out;
        }

        @media (max-width: 992px) {
            .label { font-size: 9px; }
            .legend-table { font-size: 14px; }
            h1 { font-size: 2rem; }
            .tooltip { font-size: 13px; padding: 10px 14px; }
        }

        @media (max-width: 600px) {
            .label { font-size: 7px; }
            .legend-table th, .legend-table td { padding: 10px 14px; }
            .legend-cell { width: 22px; height: 22px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>China's Streaming Media Market Popularity</h1>
            <p class="subtitle">
                Grid cartogram visualizing <strong>user engagement</strong> with Tencent Video, iQiyi, Youku, Bilibili across <strong>31 mainland provinces</strong>.<br>
                <em>Tiers reflect estimated national market share contribution — a window into digital entertainment trends.</em>
            </p>
        </div>

        <div class="cartogram-card">
            <div class="pixel-grid-overlay"></div>
            <svg id="cartogram"></svg>
        </div>

        <!-- Legend Table with Colored Cells -->
        <table class="legend-table">
            <thead>
                <tr><th colspan="3">Market Popularity Tier</th></tr>
            </thead>
            <tbody>
                <tr>
                    <td><div class="legend-cell high"></div></td>
                    <td class="legend-tier high">Tier 1 – Dominant</td>
                    <td>&gt; 4.0% national share</td>
                </tr>
                <tr>
                    <td><div class="legend-cell medium"></div></td>
                    <td class="legend-tier medium">Tier 2 – Strong</td>
                    <td>2.0% – 4.0%</td>
                </tr>
                <tr>
                    <td><div class="legend-cell low"></div></td>
                    <td class="legend-tier low">Tier 3 – Emerging</td>
                    <td>&lt; 2.0%</td>
                </tr>
            </tbody>
        </table>

        <p class="footer">
            Data synthesized from CNNIC Internet Reports, QuestMobile, App Annie (2024–2025). Proportions reflect user base and watch time.
        </p>

        <div class="tooltip" id="tooltip"></div>
    </div>

    <script>
        // === DATA: 31 Provinces with estimated streaming market share contribution ===
        const streamingData = [
            { province: "Guangdong", share: 8.7, tier: "high" },
            { province: "Shandong", share: 6.3, tier: "high" },
            { province: "Henan", share: 5.9, tier: "high" },
            { province: "Sichuan", share: 5.2, tier: "high" },
            { province: "Hebei", share: 4.9, tier: "high" },
            { province: "Hunan", share: 4.6, tier: "high" },
            { province: "Zhejiang", share: 4.3, tier: "high" },
            { province: "Anhui", share: 3.9, tier: "medium" },
            { province: "Jiangsu", share: 3.8, tier: "medium" },
            { province: "Hubei", share: 3.7, tier: "medium" },
            { province: "Guangxi", share: 3.5, tier: "medium" },
            { province: "Yunnan", share: 3.3, tier: "medium" },
            { province: "Jiangxi", share: 3.1, tier: "medium" },
            { province: "Liaoning", share: 2.9, tier: "medium" },
            { province: "Heilongjiang", share: 2.7, tier: "medium" },
            { province: "Shaanxi", share: 2.5, tier: "medium" },
            { province: "Fujian", share: 2.4, tier: "low" },
            { province: "Shanxi", share: 2.3, tier: "low" },
            { province: "Guizhou", share: 2.2, tier: "low" },
            { province: "Chongqing", share: 2.1, tier: "low" },
            { province: "Jilin", share: 2.0, tier: "low" },
            { province: "Gansu", share: 1.9, tier: "low" },
            { province: "Inner Mongolia", share: 1.7, tier: "low" },
            { province: "Xinjiang", share: 1.6, tier: "low" },
            { province: "Shanghai", share: 1.5, tier: "low" },
            { province: "Beijing", share: 1.4, tier: "low" },
            { province: "Tianjin", share: 1.3, tier: "low" },
            { province: "Ningxia", share: 1.2, tier: "low" },
            { province: "Qinghai", share: 1.1, tier: "low" },
            { province: "Hainan", share: 1.0, tier: "low" },
            { province: "Tibet", share: 0.8, tier: "low" }
        ];

        // === GRID CONFIG ===
        const cols = 6;
        const rows = Math.ceil(streamingData.length / cols);
        const margin = { top: 70, right: 70, bottom: 90, left: 70 };
        const width = 1250 - margin.left - margin.right;
        const height = 850 - margin.top - margin.bottom;

        const cellW = width / cols;
        const cellH = height / rows;
        const squareSize = Math.min(cellW, cellH) * 0.72;

        const svg = d3.select("#cartogram")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

        const tierColor = {
            high: "#9c27b0",
            medium: "#3f51b5",
            low: "#1a237e"
        };

        // === RENDER UNIFORM GRID ===
        streamingData.forEach((d, i) => {
            const col = i % cols;
            const row = Math.floor(i / cols);
            const cx = col * cellW + cellW / 2;
            const cy = row * cellH + cellH / 2;

            // Square
            const rect = svg.append("rect")
                .attr("class", `province-rect tier-${d.tier}`)
                .attr("x", cx - squareSize / 2)
                .attr("y", cy - squareSize / 2)
                .attr("width", squareSize)
                .attr("height", squareSize)
                .attr("fill", tierColor[d.tier])
                .on("mouseover", function(event) {
                    d3.select(this)
                        .attr("stroke", "#ffff00")
                        .attr("stroke-width", 3)
                        .style("filter", "brightness(1.5) drop-shadow(0 0 12px #ffff00)");

                    const [x, y] = [event.pageX, event.pageY];
                    d3.select("#tooltip")
                        .style("opacity", 1)
                        .style("left", (x + 18) + "px")
                        .style("top", (y - 15) + "px")
                        .html(`
                            <strong style="font-size:1.15em; color:#00ffff;">${d.province}</strong><br>
                            <span style="color:#ffeb3b;">Tier ${d.tier === 'high' ? '1' : d.tier === 'medium' ? '2' : '3'}</span><br>
                            <strong style="font-size:1.2em;">${d.share.toFixed(1)}%</strong> of national market
                        `);
                })
                .on("mousemove", function(event) {
                    d3.select("#tooltip")
                        .style("left", (event.pageX + 18) + "px")
                        .style("top", (event.pageY - 15) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .attr("stroke", "#222")
                        .attr("stroke-width", 1.5)
                        .style("filter", "drop-shadow(0 0 3px currentColor)");
                    d3.select("#tooltip").style("opacity", 0);
                });

            // Label
            svg.append("text")
                .attr("class", "label")
                .attr("x", cx)
                .attr("y", cy)
                .text(d.province)
                .style("font-size", d.province.length > 8 ? "8.5px" : "11px");
        });

        // Subtle grid lines
        svg.selectAll(".vline")
            .data(d3.range(cols + 1))
            .enter()
            .append("line")
            .attr("x1", i => i * cellW)
            .attr("y1", 0)
            .attr("x2", i => i * cellW)
            .attr("y2", height)
            .attr("stroke", "rgba(0,255,255,0.12)")
            .attr("stroke-width", 0.8);

        svg.selectAll(".hline")
            .data(d3.range(rows + 1))
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("y1", i => i * cellH)
            .attr("x2", width)
            .attr("y2", i => i * cellH)
            .attr("stroke", "rgba(0,255,255,0.12)")
            .attr("stroke-width", 0.8);
    </script>
</body>
</html>